{"version":3,"file":"donut-chart.js","sources":["../../../src/components/vault-reporting/donut-chart.gts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: BUSL-1.1\n */\n\nimport './donut-chart.scss';\n\nimport Component from '@glimmer/component';\n\nimport {\n  HdsCardContainer,\n  HdsTextDisplay,\n} from '@hashicorp/design-system-components/components';\nimport LinealArc from '@lineal-viz/lineal/components/lineal/arc/index.js';\nimport LinealArcs from '@lineal-viz/lineal/components/lineal/arcs/index.js';\nimport LinealFluid from '@lineal-viz/lineal/components/lineal/fluid/index.js';\nimport { concat } from '@ember/helper';\n\nexport interface SSUReportingDonutChartSignature {\n  Args: {\n    data: { value: number; label: string }[];\n    title: string;\n  };\n\n  Blocks: {\n    default: [];\n  };\n\n  Element: HTMLElement;\n}\nexport default class SSUReportingDonutChart extends Component<SSUReportingDonutChartSignature> {\n  get data() {\n    return (this.args.data || []).map((datum, index) => {\n      return {\n        ...datum,\n        scaleIndex: index + 1,\n      };\n    });\n  }\n\n  get total() {\n    return this.data.reduce((runningTotal, { value }) => {\n      return runningTotal + value;\n    }, 0);\n  }\n\n  get a11yLabel() {\n    const title = `Total of ${this.total} ${this.args.title}.`;\n\n    const itemsDescription = this.data\n      .map(({ value, label }) => {\n        return `${value} ${label}`;\n      })\n      .join(', ');\n\n    return `${title} Comprised of ${itemsDescription}.`;\n  }\n\n  getOffset(width: number, height: number) {\n    return `translate(${width / 2}, ${height / 2})`;\n  }\n\n  getInnerRadius(width: number, height: number) {\n    const computedRadius = Math.min(width, height) / 2 - 50;\n    // Smallest inner radius is 60 to allow for text\n    return Math.max(computedRadius, 60);\n  }\n\n  getOuterRadius(width: number, height: number) {\n    // Smallest inner radius is 60 to allow for text\n    const computedRadius = Math.min(width, height) / 2;\n    return Math.max(computedRadius, 110);\n  }\n\n  <template>\n    <HdsCardContainer\n      ...attributes\n      class=\"ssu-donut-chart__container\"\n      @hasBorder={{true}}\n    >\n      <div class=\"ssu-donut-chart__row\">\n        {{! TODO: Figure out glint errors on lineal components }}\n        {{! @glint-expect-error }}\n        <LinealFluid class=\"ssu-donut-chart__fluid\" as |width height|>\n          <svg\n            width=\"100%\"\n            height=\"100%\"\n            class=\"ssu-donut-chart__chart\"\n            tabindex=\"0\"\n            role=\"img\"\n            aria-label={{this.a11yLabel}}\n          >\n            <g transform={{this.getOffset width height}}>\n              {{! @glint-expect-error }}\n              <LinealArcs\n                @data={{this.data}}\n                {{! @glint-expect-error }}\n                @theta=\"value\"\n                @colorScale=\"nominal\"\n                as |pie|\n              >\n                {{#each pie as |slice|}}\n                  {{! @glint-expect-error }}\n                  <LinealArc\n                    data-test-vault-reporting-slice={{slice.data.label}}\n                    @startAngle={{slice.startAngle}}\n                    @endAngle={{slice.endAngle}}\n                    @outerRadius={{this.getOuterRadius width height}}\n                    @innerRadius={{this.getInnerRadius width height}}\n                    stroke-width=\"2\"\n                    class={{slice.cssClass}}\n                  />\n                {{/each}}\n              </LinealArcs>\n              <foreignObject\n                transform=\"translate(-60 -30)\"\n                width=\"120\"\n                height=\"120\"\n              >\n                <div class=\"ssu-donut-chart__total-summary\">\n                  <HdsTextDisplay @size=\"500\">\n                    {{this.total}}\n                  </HdsTextDisplay>\n                  <HdsTextDisplay @size=\"200\">\n                    {{@title}}\n                  </HdsTextDisplay>\n                </div>\n              </foreignObject>\n            </g>\n          </svg>\n        </LinealFluid>\n        <div class=\"ssu-donut-chart__legend\">\n          {{#each this.data as |datum|}}\n            <HdsTextDisplay\n              data-test-vault-reporting-legend-item={{datum.label}}\n              class=\"ssu-donut-chart__legend-item\n                {{concat 'ssu-donut-chart__legend-item-' datum.scaleIndex}}\"\n            >{{datum.value}} {{datum.label}} </HdsTextDisplay>\n          {{/each}}\n        </div>\n      </div>\n    </HdsCardContainer>\n  </template>\n}\n"],"names":["SSUReportingDonutChart","Component","data","args","map","datum","index","scaleIndex","total","reduce","runningTotal","value","a11yLabel","title","itemsDescription","label","join","getOffset","width","height","getInnerRadius","computedRadius","Math","min","max","getOuterRadius","setComponentTemplate","precompileTemplate","strictMode","scope","HdsCardContainer","LinealFluid","LinealArcs","LinealArc","HdsTextDisplay","concat"],"mappings":";;;;;;;;;AAAA;;;AAGC;AA2Bc,MAAMA,+BAA+BC,SAAU,CAAA;EAC5D,IAAIC,IAAOA,GAAA;AACT,IAAA,OAAO,CAAC,IAAI,CAACC,IAAI,CAACD,IAAI,IAAI,EAAE,EAAEE,GAAG,CAAC,CAACC,KAAO,EAAAC,KAAA,KAAA;MACxC,OAAO;AACL,QAAA,GAAGD,KAAK;QACRE,UAAA,EAAYD,KAAQ,GAAA;OACtB;AACF,KAAA,CAAA;AACF;EAEA,IAAIE,KAAQA,GAAA;IACV,OAAO,IAAI,CAACN,IAAI,CAACO,MAAM,CAAC,CAACC,YAAA,EAAc;AAAEC,MAAAA;AAAO,KAAA,KAAA;MAC9C,OAAOD,YAAe,GAAAC,KAAA;KACrB,EAAA,CAAA,CAAA;AACL;EAEA,IAAIC,SAAYA,GAAA;AACd,IAAA,MAAMC,QAAQ,CAAY,SAAA,EAAA,IAAI,CAACL,KAAK,CAAI,CAAA,EAAA,IAAI,CAACL,IAAI,CAACU,KAAK,CAAG,CAAA,CAAA;IAE1D,MAAMC,gBAAmB,GAAA,IAAI,CAACZ,IAAI,CAC/BE,GAAG,CAAC,CAAC;MAAEO,KAAK;AAAEI,MAAAA;AAAO,KAAA,KAAA;AACpB,MAAA,OAAO,CAAGJ,EAAAA,KAAA,CAASI,CAAAA,EAAAA,MAAO,CAAA;AAC5B,KAAA,CAAA,CACCC,IAAI,CAAC,IAAA,CAAA;AAER,IAAA,OAAO,CAAGH,EAAAA,KAAA,CAAsBC,cAAAA,EAAAA,gBAAA,CAAmB,CAAA,CAAA;AACrD;AAEAG,EAAAA,SAAAA,CAAUC,KAAa,EAAEC,MAAc,EAAE;IACvC,OAAO,CAAA,UAAA,EAAaD,KAAQ,GAAA,CAAA,KAAMC,MAAA,GAAS,CAAE,CAAE,CAAA,CAAA;AACjD;AAEAC,EAAAA,cAAAA,CAAeF,KAAa,EAAEC,MAAc,EAAE;AAC5C,IAAA,MAAME,iBAAiBC,IAAK,CAAAC,GAAG,CAACL,KAAA,EAAOC,UAAU,CAAI,GAAA,EAAA;AACrD;AACA,IAAA,OAAOG,IAAA,CAAKE,GAAG,CAACH,cAAgB,EAAA,EAAA,CAAA;AAClC;AAEAI,EAAAA,cAAAA,CAAeP,KAAa,EAAEC,MAAc,EAAE;AAC5C;IACA,MAAME,cAAiB,GAAAC,IAAA,CAAKC,GAAG,CAACL,OAAOC,MAAU,CAAA,GAAA,CAAA;AACjD,IAAA,OAAOG,IAAA,CAAKE,GAAG,CAACH,cAAgB,EAAA,GAAA,CAAA;AAClC;AAEA,EAAA;IAAAK,oBAAA,CAAAC,kBAAA,CAoEA,4hEAAA,EAAA;MAAAC,UAAA,EAAA,IAAA;AAAAC,MAAAA,KAAA,EAAAA,OAAA;QAAAC,gBAAA;QAAAC,WAAA;QAAAC,UAAA;QAAAC,SAAA;QAAAC,cAAA;AAAAC,QAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}