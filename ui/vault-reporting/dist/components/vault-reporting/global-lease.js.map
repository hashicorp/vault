{"version":3,"file":"global-lease.js","sources":["../../../src/components/vault-reporting/global-lease.gts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: BUSL-1.1\n */\n\nimport Component from '@glimmer/component';\nimport {\n  HdsCardContainer,\n  HdsTextDisplay,\n  HdsApplicationState,\n  HdsAlert,\n} from '@hashicorp/design-system-components/components';\nimport TitleRow from './base/title-row.gts';\n\nimport './global-lease.scss';\nimport cssCustomProperty from '../../modifiers/css-custom-property.ts';\nimport type { HdsApplicationStateSignature } from '@hashicorp/design-system-components/components/hds/application-state/index';\nimport { htmlSafe } from '@ember/template';\n\nexport interface GlobalLeaseSignature {\n  Args: {\n    count?: number;\n    quota?: number;\n  };\n\n  Blocks: {\n    default: [];\n    /** We optionally yield application state to allow for overrides on empty state eg:\n     * <SSUReportingGlobalLease ...>\n     *   <:empty as |A|>\n     *     <A.Header @title=\"Custom Title\" />\n     *     <A.Body @text=\"Custom description\" />\n     *   </:empty>\n     * </SSUReportingGlobalLease>\n     * */\n    empty: HdsApplicationStateSignature['Blocks']['default'];\n  };\n\n  Element: HTMLElement;\n}\n\nexport default class GlobalLease extends Component<GlobalLeaseSignature> {\n  get percentage() {\n    const { count = 0, quota = 0 } = this.args;\n\n    return Math.round(Math.min((count / quota) * 100, 100));\n  }\n\n  get progressFillClass() {\n    if (this.percentage >= 100) {\n      return 'ssu-global-lease__progress-fill--exceeded';\n    }\n    return '';\n  }\n\n  get formattedCount() {\n    const formatter = new Intl.NumberFormat('en-US', {\n      notation: 'compact',\n      compactDisplay: 'short',\n    });\n\n    const { count = 0, quota = 0 } = this.args;\n    const formattedCount = formatter.format(count);\n    const formattedTotal = formatter.format(quota);\n\n    return `${formattedCount} / ${formattedTotal}`;\n  }\n\n  get percentageString() {\n    return `${this.percentage}%`;\n  }\n\n  get hasData() {\n    return this.args.quota && typeof this.args.quota === 'number';\n  }\n\n  get description() {\n    if (this.hasData) {\n      return htmlSafe(\n        'Total number of active <a class=\"hds-link-inline--color-secondary\" href=\"https://developer.hashicorp.com/vault/docs/concepts/lease\" target=\"_blank\" data-test-vault-reporting-global-lease-description-link>leases</a> for this quota.',\n      );\n    }\n  }\n\n  get linkUrl() {\n    if (this.hasData) {\n      return 'https://developer.hashicorp.com/vault/tutorials/operations/resource-quotas#global-default-lease-count-quota';\n    }\n  }\n\n  get alert():\n    | { color: 'warning' | 'neutral'; description: string }\n    | undefined {\n    if (this.percentage >= 100) {\n      return {\n        color: 'warning',\n        description:\n          'Global lease quota limit reached. If lease creation is blocked, reduce usage or increase the limit.',\n      };\n    }\n\n    if (this.percentage >= 95) {\n      return {\n        color: 'neutral',\n        description:\n          'Approaching quota limit. Reduce usage or increase the lease limit to avoid blocking new leases.',\n      };\n    }\n  }\n\n  <template>\n    <HdsCardContainer\n      data-test-vault-reporting-global-lease\n      @hasBorder={{true}}\n      class=\"ssu-global-lease\"\n      {{cssCustomProperty\n        \"--vault-reporting-global-lease-percentage\"\n        this.percentageString\n      }}\n      ...attributes\n    >\n      <TitleRow\n        @title=\"Global lease count quota\"\n        @description={{this.description}}\n        @linkText=\"Documentation\"\n        @linkIcon=\"docs-link\"\n        @linkUrl={{this.linkUrl}}\n        @linkTarget=\"_blank\"\n      />\n      {{#if this.hasData}}\n        <HdsTextDisplay\n          @size=\"300\"\n          @weight=\"medium\"\n          data-test-vault-reporting-global-lease-percentage-text\n        >{{this.percentage}}%</HdsTextDisplay>\n\n        {{#if this.alert}}\n          <HdsAlert\n            data-test-vault-reporting-global-lease-alert\n            class=\"ssu-global-lease__alert\"\n            @type=\"compact\"\n            @color={{this.alert.color}}\n            as |A|\n          >\n            <A.Description>{{this.alert.description}}</A.Description>\n          </HdsAlert>\n        {{/if}}\n\n        <div class=\"ssu-global-lease__progress-wrapper\">\n          <div class=\"ssu-global-lease__progress-bar\">\n            <div\n              class=\"ssu-global-lease__progress-fill {{this.progressFillClass}}\"\n              data-test-vault-reporting-global-lease-fill\n            ></div>\n          </div>\n          <span>\n            <HdsTextDisplay\n              @size=\"200\"\n              @weight=\"semibold\"\n              data-test-vault-reporting-global-lease-count-text\n            >\n              {{this.formattedCount}}\n            </HdsTextDisplay>\n          </span>\n        </div>\n      {{else}}\n\n        <HdsApplicationState\n          data-test-vault-reporting-global-lease-empty-state\n          class=\"ssu-global-lease__empty-state\"\n          as |A|\n        >\n          {{#if (has-block \"empty\")}}\n            {{yield A to=\"empty\"}}\n          {{else}}\n            <A.Body\n              data-test-vault-reporting-global-lease-empty-state-description\n              @text=\"Lease quotas enforce limits on active secrets and tokens. It's recommended to enable this to protect stability for this Vault cluster.\"\n            />\n\n            <A.Footer as |F|>\n              <F.LinkStandalone\n                data-test-vault-reporting-global-lease-empty-state-link\n                @icon=\"docs-link\"\n                @iconPosition=\"trailing\"\n                @text=\"Global lease count quota\"\n                @href=\"https://developer.hashicorp.com/vault/tutorials/operations/resource-quotas#global-default-lease-count-quota\"\n                target=\"_blank\"\n              />\n            </A.Footer>\n          {{/if}}\n        </HdsApplicationState>\n      {{/if}}\n\n    </HdsCardContainer>\n  </template>\n}\n"],"names":["GlobalLease","Component","percentage","count","quota","args","Math","round","min","progressFillClass","formattedCount","formatter","Intl","NumberFormat","notation","compactDisplay","format","formattedTotal","percentageString","hasData","description","htmlSafe","linkUrl","alert","color","setComponentTemplate","precompileTemplate","strictMode","scope","HdsCardContainer","cssCustomProperty","TitleRow","HdsTextDisplay","HdsAlert","HdsApplicationState"],"mappings":";;;;;;;;AAAA;;;AAGC;AAsCc,MAAMA,oBAAoBC,SAAU,CAAA;EACjD,IAAIC,UAAaA,GAAA;IACf,MAAM;AAAEC,MAAAA,KAAQ,GAAA,CAAC;AAAEC,MAAAA,KAAA,GAAQ;KAAG,GAAG,IAAI,CAACC,IAAI;AAE1C,IAAA,OAAOC,IAAA,CAAKC,KAAK,CAACD,IAAK,CAAAE,GAAG,CAAEL,KAAA,GAAQC,KAAK,GAAI,GAAK,EAAA,GAAA,CAAA,CAAA;AACpD;EAEA,IAAIK,iBAAoBA,GAAA;AACtB,IAAA,IAAI,IAAI,CAACP,UAAU,IAAI,GAAK,EAAA;AAC1B,MAAA,OAAO,2CAAA;AACT;AACA,IAAA,OAAO,EAAA;AACT;EAEA,IAAIQ,cAAiBA,GAAA;IACnB,MAAMC,SAAY,GAAA,IAAIC,IAAK,CAAAC,YAAY,CAAC,OAAS,EAAA;AAC/CC,MAAAA,QAAU,EAAA,SAAA;AACVC,MAAAA,cAAgB,EAAA;AAClB,KAAA,CAAA;IAEA,MAAM;AAAEZ,MAAAA,KAAQ,GAAA,CAAC;AAAEC,MAAAA,KAAA,GAAQ;KAAG,GAAG,IAAI,CAACC,IAAI;AAC1C,IAAA,MAAMK,cAAA,GAAiBC,SAAU,CAAAK,MAAM,CAACb,KAAA,CAAA;AACxC,IAAA,MAAMc,cAAA,GAAiBN,SAAU,CAAAK,MAAM,CAACZ,KAAA,CAAA;AAExC,IAAA,OAAO,CAAGM,EAAAA,cAAA,CAAoBO,GAAAA,EAAAA,eAAgB,CAAA;AAChD;EAEA,IAAIC,gBAAmBA,GAAA;AACrB,IAAA,OAAO,CAAG,EAAA,IAAI,CAAChB,UAAU,CAAG,CAAA,CAAA;AAC9B;EAEA,IAAIiB,OAAUA,GAAA;AACZ,IAAA,OAAO,IAAI,CAACd,IAAI,CAACD,KAAK,IAAI,OAAO,IAAI,CAACC,IAAI,CAACD,KAAK,KAAK,QAAA;AACvD;EAEA,IAAIgB,WAAcA,GAAA;IAChB,IAAI,IAAI,CAACD,OAAO,EAAE;MAChB,OAAOE,QACL,CAAA,wOAAA,CAAA;AAEJ;AACF;EAEA,IAAIC,OAAUA,GAAA;IACZ,IAAI,IAAI,CAACH,OAAO,EAAE;AAChB,MAAA,OAAO,6GAAA;AACT;AACF;EAEA,IAAII,KAAAA,GAEU;AACZ,IAAA,IAAI,IAAI,CAACrB,UAAU,IAAI,GAAK,EAAA;MAC1B,OAAO;AACLsB,QAAAA,KAAO,EAAA,SAAA;AACPJ,QAAAA,WACE,EAAA;OACJ;AACF;AAEA,IAAA,IAAI,IAAI,CAAClB,UAAU,IAAI,EAAI,EAAA;MACzB,OAAO;AACLsB,QAAAA,KAAO,EAAA,SAAA;AACPJ,QAAAA,WACE,EAAA;OACJ;AACF;AACF;AAEA,EAAA;IAAAK,oBAAA,CAAAC,kBAAA,CAqFA,kyEAAA,EAAA;MAAAC,UAAA,EAAA,IAAA;AAAAC,MAAAA,KAAA,EAAAA,OAAA;QAAAC,gBAAA;QAAAC,iBAAA;QAAAC,QAAA;QAAAC,cAAA;QAAAC,QAAA;AAAAC,QAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}