{"version":3,"file":"export.js","sources":["../../../../src/components/vault-reporting/dashboard/export.gts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: BUSL-1.1\n */\n\nimport Component from '@glimmer/component';\nimport { HdsDropdown } from '@hashicorp/design-system-components/components';\n\nimport type { UsageDashboardData } from '../../../types';\n\nexport interface DashboardExportSignature {\n  Args: {\n    data?: UsageDashboardData;\n  };\n\n  Blocks: {\n    default: [];\n  };\n  Element: HTMLElement;\n}\n\nexport default class DashboardExport extends Component<DashboardExportSignature> {\n  #getNestedRows(records: Record<string, number>, prefix: string = '') {\n    return Object.entries(records).map(([key, value]) => {\n      return [`${prefix} ${key}`, value];\n    });\n  }\n\n  get dataAsDownloadableJSONString() {\n    const { data } = this.args;\n    const file = new Blob([JSON.stringify(data, null, '    ')], {\n      type: 'application/json',\n    });\n    return URL.createObjectURL(file);\n  }\n\n  get dataAsDownloadableCSVString() {\n    const headers = ['Metric', 'Count/Breakdown'];\n    // Manually define rows as looping through the data does not leave the most legible structure\n    const rows = [\n      headers,\n      ['Child Namespaces', this.args?.data?.namespaces || 0],\n      [\n        'Total KV Secrets',\n        (this.args.data?.kvv1_secrets || 0) +\n          (this.args.data?.kvv2_secrets || 0),\n      ],\n      ['KV V1 Secrets', this.args.data?.kvv1_secrets || 0],\n      ['KV V2 Secrets', this.args.data?.kvv2_secrets || 0],\n      ['Secret Syncs', this.args.data?.secrets_sync || 0],\n      ['PKI Roles', this.args.data?.pki?.total_roles || 0],\n      ...this.#getNestedRows(\n        this.args.data?.secret_engines || {},\n        'Secret Engine',\n      ),\n      ...this.#getNestedRows(this.args.data?.auth_methods || {}, 'Auth Method'),\n      [\n        'Global Lease Count',\n        this.args.data?.lease_count_quotas.global_lease_count_quota.count || 0,\n      ],\n      [\n        'Global Lease Quota',\n        this.args.data?.lease_count_quotas.global_lease_count_quota.capacity ||\n          0,\n      ],\n      [\n        'Cluster Disaster Recovery',\n        this.args?.data?.replication_status.dr_state || '-',\n      ],\n      [\n        'Cluster Disaster Recovery Primary',\n        this.args?.data?.replication_status.dr_primary ?? '-',\n      ],\n      [\n        'Cluster Performance',\n        this.args?.data?.replication_status.pr_state || '-',\n      ],\n      [\n        'Cluster Performance Primary',\n        this.args?.data?.replication_status.pr_primary ?? '-',\n      ],\n    ];\n    // Escape double quotes, quote cell content and separate with comma\n    const csvString = rows\n      .map((row) =>\n        row\n          .map((cell) => {\n            const escaped = String(cell).replace(/\"/g, '\"\"');\n            return `\"${escaped}\"`;\n          })\n          .join(','),\n      )\n      .join('\\r\\n');\n\n    const blob = new Blob([csvString], { type: 'text/csv' });\n\n    return URL.createObjectURL(blob);\n  }\n\n  <template>\n    {{#if @data}}\n      <HdsDropdown @matchToggleWidth={{true}} as |D|>\n        <D.ToggleButton data-test-export-toggle @text=\"Export\" />\n        <D.Interactive\n          data-test-export-json\n          @href={{this.dataAsDownloadableJSONString}}\n          download=\"vault-usage-dashboard.json\"\n        >JSON</D.Interactive>\n        <D.Interactive\n          data-test-export-csv\n          @href={{this.dataAsDownloadableCSVString}}\n          download=\"vault-usage-dashboard.csv\"\n        >CSV</D.Interactive>\n      </HdsDropdown>\n    {{/if}}\n  </template>\n}\n"],"names":["DashboardExport","Component","#getNestedRows","records","prefix","Object","entries","map","key","value","dataAsDownloadableJSONString","data","args","file","Blob","JSON","stringify","type","URL","createObjectURL","dataAsDownloadableCSVString","headers","rows","namespaces","kvv1_secrets","kvv2_secrets","secrets_sync","pki","total_roles","secret_engines","auth_methods","lease_count_quotas","global_lease_count_quota","count","capacity","replication_status","dr_state","dr_primary","pr_state","pr_primary","csvString","row","cell","escaped","String","replace","join","blob","setComponentTemplate","precompileTemplate","strictMode","scope","HdsDropdown"],"mappings":"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"}