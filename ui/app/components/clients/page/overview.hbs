{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

<Clients::RunningTotal
  @isSecretsSyncActivated={{this.flags.secretsSyncIsActivated}}
  @byMonthNewClients={{this.byMonthNewClients}}
  @isHistoricalMonth={{and (not this.isCurrentMonth) (not this.isDateRange)}}
  @isCurrentMonth={{this.isCurrentMonth}}
  @runningTotals={{this.totalUsageCounts}}
  @upgradeData={{this.upgradesDuringActivity}}
  @mountPath={{@mountPath}}
/>

{{#if this.hasAttributionData}}
  <Hds::Form::Select::Base
    class="has-bottom-margin-m"
    aria-label="Month"
    name="month"
    {{on "input" this.selectMonth}}
    @width="200px"
    data-test-select="attribution-month"
    as |S|
  >
    <S.Options>
      <option value="">Select month</option>
      {{#each this.months as |m|}}
        <option value={{m.value}} selected={{if (eq m.value this.selectedMonth) true false}}>{{m.display}}</option>
      {{/each}}
    </S.Options>
  </Hds::Form::Select::Base>
  {{#if this.tableData}}
    <Hds::Table
      @model={{this.paginatedTableData}}
      @columns={{array
        (hash key="namespace" label="Namespace" isSortable=true)
        (hash key="label" label="Mount path" isSortable=true)
        (hash key="mount_type" label="Mount type" isSortable=true)
        (hash key="clients" label="Counts" isSortable=true)
      }}
      @sortBy="clients"
      @sortOrder="desc"
      @onSort={{this.updateSort}}
      data-test-clients-attribution-table
    >
      <:body as |B|>
        <B.Tr data-test-attribution-table-row>
          <B.Td>{{B.data.namespace}}</B.Td>
          <B.Td>{{B.data.label}}</B.Td>
          {{#if (eq B.data.mount_type "deleted mount")}}
            <B.Td><Hds::Badge @text="Disabled" @type="outlined" /></B.Td>
          {{else}}
            <B.Td>{{B.data.mount_type}}</B.Td>
          {{/if}}
          <B.Td data-test-attribution-table-counts={{B.rowIndex}}>{{B.data.clients}}</B.Td>
        </B.Tr>
      </:body>
    </Hds::Table>

    <Hds::Pagination::Numbered
      @showSizeSelector={{false}}
      @totalItems={{this.tableData.length}}
      @currentPage={{this.currentPage}}
      @pageSize={{this.pageSize}}
      @currentPageSize={{this.pageSize}}
      {{!-- @route={{"vault.cluster.clients.counts.overview"}} --}}
      @onPageChange={{this.onPageChange}}
      data-test-pagination
    />
  {{else}}
    <Hds::Card::Container @level="mid" @hasBorder={{true}} class="has-padding-l" data-test-card="attribution">
      <Hds::ApplicationState as |A|>
        <A.Header @title={{this.tableHeaderMessage}} />
        <A.Body @text={{this.tableBodyMessage}} />
        <A.Footer as |F|>
          <F.LinkStandalone
            @icon="file-text"
            @text="Client count documentation"
            @href="https://developer.hashicorp.com/vault/docs/concepts/client-count"
            @iconPosition="trailing"
          />
        </A.Footer>
      </Hds::ApplicationState>
    </Hds::Card::Container>
  {{/if}}
{{/if}}