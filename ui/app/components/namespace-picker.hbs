{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

<div class="top-padding-4 has-bottom-padding-4 has-side-padding-8" ...attributes>
  <Hds::Dropdown @enableCollisionDetection={{true}} as |D|>

    <D.ToggleButton @icon="org" @text={{or this.selected.id "-"}} @isFullWidth={{true}} data-test-namespace-toggle />

    <D.Header>

      <div class="has-padding-8">
        <Hds::Form::TextInput::Field
          @value={{this.searchInput}}
          @type="search"
          aria-label="Search namespaces"
          placeholder="Search"
          {{on "keydown" this.onKeyDown}}
          {{on "input" this.onSearchInput}}
          {{did-insert this.focusSearchInput}}
        />
      </div>

      <Hds::Separator @spacing="0" />

      {{#if this.hasSearchInput}}
        <div>
          {{this.searchInputHelpText}}
        </div>
      {{/if}}

      <div class="has-padding-8">
        {{this.namespaceLabel}}
        <Hds::BadgeCount @text={{or this.namespaceCount 0}} />
      </div>

    </D.Header>

    {{#unless this.namespaceCount}}
      <D.Generic>
        {{this.noNamespacesMessage}}
      </D.Generic>
    {{/unless}}

    <div class="is-overflow-y-auto is-max-drawer-height" {{did-insert this.setupScrollListener}}>
      {{#each this.visibleNamespaceOptions as |option|}}
        <D.Checkmark
          @selected={{eq option.id this.selected.id}}
          {{on "click" (fn this.onChange option)}}
          data-test-namespace-link={{option.path}}
        >
          {{option.label}}
        </D.Checkmark>
      {{/each}}
    </div>

    {{! Check if the user has permissions to list namespaces. If true, display additional footer options like "Refresh list" and "Manage". }}
    {{#if this.hasListPermissions}}
      <D.Footer @hasDivider={{true}} class="is-flex-v-centered">
        <Hds::Button @color="secondary" @text="Refresh list" {{on "click" this.refreshList}} data-test-refresh-namespaces />
        <Hds::Button @color="secondary" @text="Manage" @icon="settings" @route="vault.cluster.access.namespaces" />
      </D.Footer>
    {{/if}}

  </Hds::Dropdown>
</div>