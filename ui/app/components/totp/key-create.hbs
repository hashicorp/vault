{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

<form {{on "submit" @create}}>
  <div class="box is-sideless is-fullwidth is-marginless">
    <MessageError @model={{@model}} />
    <NamespaceReminder @mode={{@mode}} @noun="TOTP key" />
    {{#if @model.generate}}
      {{#each @generatedFields as |field|}}
        {{#let (find-by "name" field @model.allFields) as |attr|}}
          {{! TODO add model validations }}
          <FormField @attr={{attr}} @model={{@model}} data-test-field />
        {{/let}}{{/each}}
    {{else}}
      {{#each @nonGeneratedFields as |field|}}
        {{#let (find-by "name" field @model.allFields) as |attr|}}
          {{! TODO add model validations }}
          <FormField @attr={{attr}} @model={{@model}} data-test-field />
        {{/let}}
      {{/each}}
    {{/if}}

    <Totp::KeyCreateToggleGroups @model={{@model}} />

  </div>
  <div class="field is-grouped-split box is-fullwidth is-bottomless">
    <Hds::ButtonSet>
      <Hds::Button @text={{if (eq @mode "create") "Create key" "Save"}} type="submit" data-test-totp-create />
      {{#if (eq @mode "create")}}
        <Hds::Button
          @text="Cancel"
          @color="secondary"
          @route="vault.cluster.secrets.backend.list-root"
          @model={{@model.backend}}
          @query={{hash tab="key"}}
        />
      {{else}}
        <Hds::Button
          @text="Cancel"
          @color="secondary"
          @route="vault.cluster.secrets.backend.show"
          @models={{array @model.backend @model.id}}
        />
      {{/if}}
    </Hds::ButtonSet>
  </div>
</form>