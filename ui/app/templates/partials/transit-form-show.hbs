<div class="tabs-container box is-sideless is-fullwidth is-paddingless is-marginless">
  <nav class="tabs">
    <ul>
      <li class="{{if (eq tab 'actions') 'is-active'}}">
        {{#secret-link
          secret=key.id
          mode="show"
          replace=true
          queryParams=(query-params tab='actions')
          data-test-transit-key-actions-link=true
          }}
          Key Actions
        {{/secret-link}}
      </li>

      <li class="{{if (eq tab 'details') 'is-active'}}">
        {{#secret-link
          secret=key.id
          mode="show"
          replace=true
          queryParams=(query-params tab='details')
          data-test-transit-link="details"
          }}
          Details
        {{/secret-link}}
      </li>

      <li class="{{if (eq tab 'versions') 'is-active'}}">
        {{#secret-link
          secret=key.id
          mode="show"
          replace=true
          queryParams=(query-params tab='versions')
          data-test-transit-link="versions"
          }}
          Versions
        {{/secret-link}}
      </li>
    </ul>
  </nav>
</div>

{{#unless (eq tab 'actions')}}
  <Toolbar>
    <ToolbarActions>
      {{#if (eq tab 'versions')}}
        <TransitKeyActions
          @key={{key}}
          @selectedAction="rotate"
          @capabilities={{capabilities}}
          @onRefresh={{action "refresh"}}
        />
      {{/if}}
      {{#if (eq mode "show") }}
        {{#if (or capabilities.canUpdate capabilities.canDelete)}}
          <ToolbarSecretLink
            @secret={{key.id}}
            @mode="edit"
            replace=true
          >
            Edit encryption key
          </ToolbarSecretLink>
        {{/if}}
      {{/if}}
    </ToolbarActions>
  </Toolbar>
{{/unless}}


{{#if (eq tab 'actions')}}
  <div class="transit-card-container">
    {{#each model.supportedActions as |supportedAction|}}
      {{#linked-block
        "vault.cluster.secrets.backend.actions"
        model.id
        queryParams=(hash action=supportedAction.name)
        class="transit-card"
        data-test-transit-card=supportedAction.name
      }}
        <div class="transit-icon">
          <Icon
            @glyph={{supportedAction.glyph}}
            @size="l"
            class="has-text-grey auto-width"
            aria-label={{concat backend.path " options"}} />
        </div>
        <div class="transit-description">
          <h2 class="title is-6" data-test-transit-action-title={{supportedAction.name}}>
            {{if (eq supportedAction.name 'export') 'Export Key' (humanize supportedAction.name)}}
          </h2>
          <p class="transit-action-description">{{supportedAction.description}}</p>
        </div>
      {{/linked-block}}
    {{/each}}
  </div>
{{else if (eq tab 'versions')}}
  {{#if (or
      (eq key.type "aes256-gcm96")
      (eq key.type "chacha20-poly1305")
    )
  }}
    {{#each-in key.keys as |version creationTimestamp|}}
      <div class="linked-block list-item-row" data-test-transit-key-version-row={{version}}>
        <div class="columns is-mobile">
          <div class="column is-3">
            <div class="level level-left">
              <Icon @glyph="history" class="has-text-grey-light is-padded" @size="l" />
              <strong class="has-padding is-size-6">Version {{version}}</strong>
            </div>
          </div>
          <div class="column is-4">
            <div class="td is-borderless">
              <small class="help has-text-grey">
                {{date-from-now creationTimestamp addSuffix=true }}
              </small>
            </div>
          </div>
          <div class="column is-4">
            <div class="td is-borderless">
              {{#if (coerce-eq key.minDecryptionVersion version)}}
                <p class="help level level-left">
                  <Icon @glyph="check-circle-fill" class="has-text-success" />
                  Current minimum decryption version
                </p>
              {{/if}}
            </div>
          </div>
          <div class="column is-1 is-flex-end">
            <PopupMenu name="secret-menu">
              <nav class="menu">
                <ul class="menu-list">
                  <li class="action">
                    {{#copy-button
                      clipboardText=(get key.keys version)
                      class="link button is-transparent"
                      buttonType="button"
                      success=(action (set-flash-message 'Public key copied!'))
                    }}
                      Copy Public Key
                    {{/copy-button}}
                  </li>
                </ul>
              </nav>
            </PopupMenu>
          </div>
        </div>
      </div>
    {{/each-in}}
  {{else}}
    <div class="columns is-gapless is-marginless table">
      <div class="column is-11 thead">
        <div class="columns is-marginless is-gapless">
          <div class="column is-one-third">
            <div class="th">
              Version
            </div>
          </div>
          <div class="column  is-one-third">
            <div class="th">
              Name
            </div>
          </div>
          <div class="column  is-one-third">
            <div class="th">
              Created at
            </div>
          </div>
        </div>
      </div>
      <div class="column is-1 thead is-hidden-mobile">
        <div class="column thead is-narrow">
          <div class="th"></div>
        </div>
      </div>
    </div>
    {{#each-in key.keys as |version meta|}}
      <div class="columns is-gapless is-marginless table {{if (get this (concat version '-open')) 'has-background-grey-lighter' }}"
        data-test-transit-key-version-row={{version}}>
        <div class="column {{if (get this (concat version '-open')) '' 'td' }}">
          <div class="columns is-marginless is-gapless">
            <div class="column is-11">
              <div class="columns is-marginless is-gapless">
                <div class="column is-one-third">
                  <div class="td is-borderless">
                    {{version}}
                    {{#if (coerce-eq key.minDecryptionVersion version)}}
                      <p class="help has-text-grey">(current minimum decryption version)</p>
                    {{/if}}
                  </div>
                </div>
                <div class="column is-one-third">
                  <div class="td is-borderless">
                    {{meta.name}}
                  </div>
                </div>
                <div class="column is-one-third">
                  <div class="td is-borderless">
                    <div>
                      {{date-format meta.creation_time 'MMM DD, YYYY hh:mm:ss A'}}
                      <br />
                      <small class="is-font-mono has-text-grey">
                        {{date-format meta.creation_time}}
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="column is-1 has-text-centered is-flex-v-centered">
              <button class="button is-transparent" type="button" {{action (toggle (concat version '-open') this)}}>
                <Icon
                  @glyph="more-horizontal"
                  class="has-text-black auto-width"
                  aria-label={{concat backend.path " options"}}
                />
              </button>
            </div>
          </div>
        </div>
      </div>
      {{#if (get this (concat version '-open'))}}
        <div class="table has-background-grey-lighter is-paddingless is-marginless">
          <div class="td">
            <div>
              <span class="is-label">
                Public Key
              </span>
              <pre class="has-background-transparent"><code class="is-paddingless">{{meta.public_key}}</code></pre>
              <div class="box is-fullwidth has-background-transparent is-shadowless">
                <div class="control">
                  {{#copy-button
                    clipboardText=meta.public_key
                    class="button"
                    buttonType="button"
                    success=(action (set-flash-message (concat 'Public key for version ' version ' copied!')))
                  }}
                    Copy
                  {{/copy-button}}
                </div>
              </div>
            </div>
          </div>
        </div>
      {{/if}}
    {{/each-in}}
  {{/if}}
{{else}}
  {{info-table-row label="Type" value=key.type}}
  {{info-table-row label="Deletion allowed" value=(stringify key.deletionAllowed)}}

  {{#if key.derived}}
    {{info-table-row label="Derived" value=key.derived}}
    {{info-table-row label="Convergent encryption" value=key.convergentEncryption}}
  {{/if}}
{{/if}}
