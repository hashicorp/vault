{{!
  Copyright IBM Corp. 2016, 2025
  SPDX-License-Identifier: BUSL-1.1
}}

<PageHeader as |p|>
  <p.top>
    <Page::Breadcrumbs @breadcrumbs={{@breadcrumbs}} />
  </p.top>
  <p.levelLeft>
    <h1 class="title is-3" data-test-header-title>
      {{@role.name}}
    </h1>
  </p.levelLeft>
</PageHeader>

<Toolbar aria-label="menu items for managing role {{@role.name}}">
  <ToolbarActions>
    {{#if @capabilities.canDelete}}
      <ConfirmAction
        @buttonText="Delete role"
        class="toolbar-button"
        @buttonColor="secondary"
        @onConfirmAction={{this.delete}}
        data-test-delete
      />
      <div class="toolbar-separator"></div>
    {{/if}}
    {{#if @capabilities.canGenerateCreds}}
      <ToolbarLink @route="roles.role.credentials" data-test-generate-credentials>
        Generate credentials
      </ToolbarLink>
    {{/if}}
    {{#if @capabilities.canUpdate}}
      <ToolbarLink @route="roles.role.edit" data-test-edit>
        Edit role
      </ToolbarLink>
    {{/if}}
  </ToolbarActions>
</Toolbar>

{{#each this.displayFields as |field|}}
  <InfoTableRow
    data-test-filtered-field
    @label={{this.label field}}
    @value={{get @role field}}
    @formatTtl={{includes field (array "token_max_ttl" "token_default_ttl")}}
  />
{{/each}}

{{#if @role.generated_role_rules}}
  <div class="has-top-margin-xl" data-test-generated-role-rules>
    <h2 class="title is-4">Generated role rules</h2>
    <Hds::CodeBlock @value={{@role.generated_role_rules}} @language="ruby" @hasCopyButton={{true}} as |CB|>
      <CB.Title @tag="h3">
        Role rules
      </CB.Title>
    </Hds::CodeBlock>
  </div>
{{/if}}

{{#each this.extraFields as |field|}}
  <div class="has-top-margin-xl" data-test-extra-fields={{field.label}}>
    <h2 class="title is-4 is-marginless">{{field.label}}</h2>
    {{#each-in (get @role field.key) as |key value|}}
      <InfoTableRow @label={{key}} @value={{value}} />
    {{/each-in}}
  </div>
{{/each}}