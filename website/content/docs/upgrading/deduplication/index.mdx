---
layout: docs
page_title: Resolve duplicate identities
description: >-
   Find duplicate identities in your Vault cluster and safely resolve them.
---

# Find and resolve duplicate Vault identities

Bugs in Vault versions before 1.19 might lead to duplicate identities for
entities, aliases, and groups. Duplicate identities in the persistent storage
of a Vault cluster can cause unexpected behavior as duplicate identities are
outside typical expectations and test scenarios for Vault.

Vault server logs include information to help you identify when duplicate
identities exist in a given cluster. We strongly recommend identifying
and resolving duplicates as soon as possible to return your Vault clusters to
normal, supported behavior.

## Before you start

- **You must have Vault 1.19 or later running on all clusters**.
- **You must have admin permissions for the Vault cluster**.

## Step 1: Look for duplicates

To identify duplicates in server logs:

1. Look for `core: post-unseal setup starting` to find the last unseal operation
   in the system logs of the active node. For example:

    ```text
    [INFO]  core: post-unseal setup starting
    ...<check here> ...
    [INFO]  core: post-unseal setup complete
    ```

1. Check for `DUPLICATES DETECTED` between the `setup starting` and
   `setup complete` entries in the system log. For example:

    ```text
    [WARN]  identity: DUPLICATES DETECTED, see following logs for details [...]
    ```

If you do not see entires for `DUPLICATES DETECTED`, the current cluster is
clean and you can move to the next cluster.

<Note>

If you use replication, repeat the duplication check on all primary clusters and
all **performance replication** (PR) secondary clusters. PR secondary clusters
handle client requests and may have additional, **local** duplicates.

Disaster recovery (DR) secondaries do not handle client requests, so you do not
need to check DR secondary clusters separately.

</Note>

## Step 2: Resolve any duplicates

1. Identify the duplication type for each entry in your server logs:
    - **In PR/DR deployments**: identify duplication types on your primary
      clusters.
    - **In PR deployments**: identify duplication types for **local aliases** on
      your performance secondaries.
1. Follow the appropriate de-duplication steps based on the duplication type:
    - [Fix different-case entity alias duplicates](/vault/docs/upgrading/deduplication/different-case)
    - [Fix entity and group duplicates](/vault/docs/upgrading/deduplication/entity-group)
    - [Fix ACL policy template duplicates](/vault/docs/upgrading/deduplication/acl-policy-templates)
    - [Fix external reference duplicates](/vault/docs/upgrading/deduplication/external-refs)

<Tip title="Local different-case entity alias duplicates">

Performance secondaries may have **local** different-case entity alias
duplicates. Local duplicates exist independently on the secondary cluster and
require explicit resolution but follow the same process as resolving non-local
[different-case entity alias duplicates](/vault/docs/upgrading/deduplication/different-case).

</Tip>


## Step 3: Enforce identity de-duplication ((#dedupe-flag))

Once you resolve existing duplicates, you need to enable the
`force-identity-deduplication` activation flag in your Vault configuration.

TODO, describe the process and any details like how each Vault node will need to
reload part of it's in-memory state which could cause a short period where
requests wait or timeout depending on size of the data.