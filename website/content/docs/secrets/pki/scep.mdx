---
layout: docs
page_title: Simple Certificate Enrollment Protocol (SCEP)
description: >-
   Understand the configuration and limitations of Vault's PKI secrets engine implementation of the Simple Certificate Enrollment Protocol (SCEP).
---

# Simple Certificate Enrollment Protocol (SCEP) <EnterpriseAlert inline="true" />

This document covers configuration and limitations of Vault's PKI Secrets Engine
implementation of the [SCEP](https://datatracker.ietf.org/doc/html/rfc8894) <EnterpriseAlert inline="true" />.

## What is Simple Certificate Enrollment Protocol (SCEP)?

SCEP is an IETF standardized protocol, [RFC 8894](https://datatracker.ietf.org/doc/html/rfc8894),
that allows clients to acquire client certificates and associated
Certificate Authority (CA) certificates.

## Enabling SCEP support on a Vault PKI mount

The following is a list of steps required to configure an existing PKI
mount to serve SCEP clients. Each of which can be broken down within three main
categories.

 1. [Authentication mechanisms](#configuring-scep-authentication-mounts)
 1. [Updating PKI tunable parameters](#updating-the-pki-mount-tunable-parameters)
 1. [PKI SCEP configuration](#pki-scep-configuration)

### Configuring SCEP Authentication mounts

The Vault SCEP implementation supports a few different authentication mechanisms in
two categories.

 1. Challenge Based authentication
   2. [Intune authentication](/vault/docs/auth/scep)
   2. [Static Challenge authentication](/vault/docs/auth/scep)
 1. [Certificate Authentication](/vault/docs/auth/cert)

For SCEP challenge based authentication one of either static challenge or InTune mechanisms
can be used to authenticate clients within a given PKI mount. This is controlled
by configuring Intune within the PKI mount's SCEP configuration, otherwise we fallback
to using static challenges.

Certificate authentication can be used, although optional, for requests without
a challenge value. This is useful for clients that are renewing their certificate without
requiring the original challenge value.

The static challenge and InTune authentication mechanisms use a dedicated SCEP
authentication mount within the same namespace, while the certificate authentication
mechanism uses a configured certificate authentication mount. Both of these mounts
are used to validate the client provided credentials along with the client's ACL policy.

For proper accounting, mounts supporting SCEP authentication should be
dedicated to this purpose, not shared with other workflows.  In other words,
create a new auth mount for SCEP even if you already have one of the same
type for other purposes.

When setting up the authentication mount for SCEP clients, the token type must
be configured to return [batch tokens](/vault/docs/concepts/tokens#batch-tokens).
Batch tokens are required to avoid an excessive amount of leases being generated
and persisted as every SCEP incoming request needs to be authenticated.

If using the `sign-verbatim` or `role:my-role-name` as a path policy, the following
ACL policy will allow an authenticated client access the required PKI SCEP paths.
```
path “pki/scep” {
  capabilities=[“read“, “update”, “create”]
}
path “pki/scep/pkiclient.exe” {
  capabilities=[“read“, “update”, “create”]
}
```

For a role base path policy, this sample policy can be used
```
path “pki/roles/my-role-name/scep” {
  capabilities=[“read“, “update”, “create”]
}
path “pki/roles/my-role-name/scep/pkiclient.exe” {
  capabilities=[“read“, “update”, “create”]
}
```

##### Sample SCEP Authentication Mounts

```
vault auth enable scep
vault write auth/scep/role/static-challenge-1 \
    auth_type="static-challenge" \
    challenge=${SCEP_PASS} \
    token_policies="access-scep" \
    token_type="batch"
```

```
vault auth enable cert
vault write auth/cert/certs/scep-ca \
    display_name="SCEP Client CA" \
    token_policies="access-scep" \
    certificate="${CERTIFICATE}" \
    token_type="batch" \
    allowed_common_names="${HOSTNAME}"
```

```
vault write auth/scep/role/intune \
 auth_type="intune" \
 token_policies="access-scep" \
 token_type="batch"
```

#### Updating the PKI mount tunable parameters

Once the authentication mount has been created and configured, the authentication mount's accessor
will need to be captured and added within the PKI mount's [delegated auth accessors](/vault/api-docs/system/mounts#delegated_auth_accessors).

To get an authentication mount's accessor field, the following command can be used.

```shell-session
$ vault read -field=accessor sys/auth/scep
$ vault read -field=accessor sys/auth/cert
```

These field accessors are then added to the mount's delegated auth accessors.

```shell-session
$ vault secrets tune \
  -delegated-auth-accessors="auth_scep_e2f4f6d5" \
  -delegated-auth-accessors="auth_cert_4088ac2d" \
  pki
```

#### PKI SCEP configuration

The following is an example of a complete SCEP configuration, with two different authentication
methods - using certificate authentication and a static secret scep authentication.

The `default_path_policy` would use the existing `scep-clients` PKI role for restrictions and defaults,
leveraging the issuer specified within the role.

```shell-session
vault write pki_int/config/scep -<<EOC
{
  "enabled": true,
  "default_path_policy": "role:scep-clients",
  "authenticators": {
    "scep": {
      "accessor": "${SCEP_ACCESSOR}",
      "scep_role": "static-challenge-1"
    },
    "cert": {
      "accessor": "${CERT_ACCESSOR}",
      "cert_role": "scep-ca"
    }
  }
}
EOC
```

## Limitations

### Intune Support

### JAMF Pro Support

JAMF Pro is supported in the static secret configuration.

## API

The PKI secrets engine has a full HTTP API. Please see the
[PKI secrets engine API](/vault/api-docs/secret/pki) for more details.
