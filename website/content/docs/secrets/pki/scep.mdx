---
layout: docs
page_title: Simple Certificate Enrollment Protocol (SCEP)
description: >-
   Understand the configuration and limitations of Vault's PKI secrets engine implementation of the Simple Certificate Enrollment Protocol (SCEP).
---

# Simple Certificate Enrollment Protocol (SCEP) <EnterpriseAlert inline="true" />

This document covers configuration and limitations of Vault's PKI Secrets Engine
implementation of the [SCEP](https://datatracker.ietf.org/doc/html/rfc8894) <EnterpriseAlert inline="true" />.

## What is Simple Certificate Enrollment Protocol (SCEP)?

SCEP is an IETF standardized protocol, [RFC 8894](https://datatracker.ietf.org/doc/html/rfc8894),
that allows clients to acquire client certificates and associated
Certificate Authority (CA) certificates.

## Enabling SCEP support on a Vault PKI mount

The following is a list of steps required to configure an existing PKI
mount to serve SCEP clients. Each of which can be broken down within three main
categories.

 1. [Authentication mechanisms](#configuring-scep-authentication)
 1. [Updating PKI tunable parameters](#updating-the-pki-mount-tunable-parameters)
 1. [PKI SCEP configuration](#pki-scep-configuration)

### Configuring SCEP Authentication

SCEP specifies a few different authentication mechanisms, of which
Vault supports three:

 1. [Static Challenge authentication](/vault/docs/auth/static-challenge)
 1. [Certificate Authentication](/vault/docs/auth/cert)
 1. [Intune authentication](/vault/docs/auth/intune)

Each of these authentication mechanisms leverage a separate Vault authentication
mount, within the same namespace, to validate the client provided credentials
along with the client's ACL policy to enforce.

% TODO: Using multiple, what happens?

For proper accounting, mounts supporting SCEP authentication should be
dedicated to this purpose, not shared with other workflows.  In other words,
create a new auth mount for SCEP even if you already have one of the same
type for other purposes.

When setting up the authentication mount for SCEP clients, the token type must
be configured to return [batch tokens](/vault/docs/concepts/tokens#batch-tokens).
Batch tokens are required to avoid an excessive amount of leases being generated
and persisted as every SCEP incoming request needs to be authenticated.

If using the `sign-verbatim` as a path policy, the following
ACL policy will allow an authenticated client access the required PKI SCEP paths.
```
path “pki/scep” {
  capabilities=[“read“, “update”, “create”]
}
path “pki/scep/pkiclient.exe” {
  capabilities=[“read“, “update”, “create”]
}
```

For a role base path policy, this sample policy can be used
```
path “pki/roles/my-role-name/scep” {
  capabilities=[“read“, “update”, “create”]
}
path “pki/roles/my-role-name/scep/pkiclient.exe” {
  capabilities=[“read“, “update”, “create”]
}
```

##### Sample SCEP Authentication Mounts

```
vault auth enable cert
vault write auth/cert/certs/scep-ca \
    display_name="SCEP Client CA" \
    token_policies="access-scep" \
    certificate="${CERTIFICATE}" \
    token_type="batch" \
    allowed_common_names="${HOSTNAME}"
```

```
vault auth enable scep 
vault write auth/scep/role/static-challenge-1 \
 auth_type="static-challenge" \
 challenge=${SCEP_PASS} \
 token_policies="access-scep" \
 token_type="batch"
```

```
vault write auth/scep/role/intune \
 auth_type="intune" \
 token_policies="access-scep" \
 token_type="batch"
```

#### Updating the PKI mount tunable parameters

Once the authentication mount has been created and configured, the authentication mount's accessor
will need to be captured and added within the PKI mount's [delegated auth accessors](/vault/api-docs/system/mounts#delegated_auth_accessors).

To get an authentication mount's accessor field, the following command can be used.

```shell-session
$ vault read -field=accessor sys/auth/cert
```

These field accessors are then added to the mount's delegated auth accessors.

```shell-session
$ vault secrets tune \
  -delegated-auth-accessors="auth_userpass_e2f4f6d5" \
  -delegated-auth-accessors="auth_cert_4088ac2d" \
  pki
```

#### PKI SCEP configuration

The following is an example of a complete SCEP configuration, with two different authentication
methods - a certificate authentication and a static secret scep authentication.

The test-label would use the existing est-clients PKI role for restrictions and defaults,
leveraging the issuer specified within the role. The other two labels, default and sign-all will
leverage a sign-verbatim type role, allowing any identifier to be issued using the default
issuer.

```shell-session
vault write pki_int/config/scep -<<EOC
{
  "enabled": true,
  "default_path_policy": "sign-verbatim",
  "authenticators": {
    "scep": {
      "accessor": "${SCEP_ACCESSOR}"
    },
    "cert": {
      "accessor": "${CERT_ACCESSOR}",
      "cert_role": "scep-ca"
    }
  }
}
EOC
```

## Limitations

### Intune Support

% TODO

### JAMF Pro Support

JAMF Pro is supported in the static secret configuration.

## API

The PKI secrets engine has a full HTTP API. Please see the
[PKI secrets engine API](/vault/api-docs/secret/pki) for more details.
