---
layout: docs
page_title: How HSM support changes Vault's behavior
description: >-
  Understand how HSM support changes the way Vault works with unseal/recovery
  keys and rekey/recovery operations.
---

# How HSM support changes Vault's behavior

@include 'alerts/enterprise-only.mdx'

This page contains information about the behavioral differences that take
effect when using Vault with an HSM.

## Key split between unseal keys and recovery keys

Normally, Vault uses a single set of unseal keys to both decrypt the
cryptographic barrier and to authorize recovery operations, such as the
[`generate-root`](/vault/api-docs/system/generate-root)
functionality.

When using an HSM, Vault instead uses two sets of keys: unseal keys and recovery
keys. This lets the HSM automatically unseal the barrier but still requires a
human to oversee recovery operations.

-> **Recovery keys:** Refer to the
 [Seal/Unseal](/vault/docs/concepts/seal#recovery-key) documentation to learn more
 about recovery keys.

## Unseal (Root) key

Vault usually generates a root key and splits it using [Shamir's Secret
Sharing](https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing) to prevent a
single operator from being able to modify and unseal Vault (see more
information about Vault's security model
[here](/vault/docs/internals/security)).

When using an HSM, Vault instead stores the root key, encrypted by the HSM,
into its internal storage. As a result, during an `init` command, the number of
key shares, threshold, and stored shares are required to be set to `1`, meaning
to not split the root key, so that the single key share is itself the root
key. (Vault does not do this automatically as it generally prefers to error
rather than change parameters set by an operator.)

Both rekeying the root key and rotation of the underlying data
encryption key are supported when using an HSM.

## Performance and availability

When Vault uses an HSM to generate various Critical Security Parameters (CSPs),
or for entropy augmentation, it needs the HSM to be online and available to
process these requests. Additionally, some operations that interact with the HSM
can happen more frequently than key generation, and may impact performance. For
example, a mount with seal wrapping enabled will interact with the HSM on every
write. Vault will interact with the HSM every time it generates a non-batch
token with entropy augmentation enabled.
