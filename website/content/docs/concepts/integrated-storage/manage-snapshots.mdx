---
layout: docs
page_title: Manage snapshots
description: >-
  Save and restore data from cluster snapshots.
---

# Manage snapshots

All Vault editions support data backup and restoration with manual snapshots of the cluster state. Vault Enterprise adds support for configurable automatic snapshots to local and cloud storage.

When you save and securely retain Vault cluster snapshots, you help defend against data corruption or sabotage. You can further support data availability in the event of catastrophic failure by retaining cluster snapshots outside cluster storage or physical datacenters where clusters operate.

This guidance provides snapshot management details, and command examples for the Vault CLI and API. Refer to the [Resources](#resources) section of this document for more details about the API endpoints and CLI commands shown in the examples.

<Tip>

If you're saving a snapshot in preparation for Vault Enterprise upgrade, review the [Automate upgrades with Vault Enterprise](/vault/tutorials/raft/raft-upgrade-automation) guide to learn how Autopilot can automate your upgrades.

</Tip>

## Prerequisites

Ensure that you carry out or understand these items **before** you try to save or restore Vault snapshots.

- **Working Vault knowledge:**
   You need some working Vault knoweldge to follow the examples. You should be familiar with using Vault with the CLI, API, or UI.

- **Valid Vault cluster configuration:**
   Your Vault cluster must have valid cluster configuration as defined in the guidance in [Vault with integrated storage reference architecture](/vault/tutorials/day-one-raft/raft-reference-architecture).

- **Vault ready for use:**
   Your Vault cluster must be in an initialized state, with keyholders available
   to enter the unseal or recovery keys. You must also have access to tokens with required capabilities to access encrypted data in the storage.

## Save a cluster snapshot

All Vault editions offer support for manually saving cluster snapshots. These example steps show how to manually take a snapshot from a Vault cluster leader node with the CLI or API.

<Note> 

Keep in mind that the exact steps needed depend on your specific Vault architecture and storage type, and can differ from the examples shown here.

</Note>

Choose a tab, and learn how to manually save a snapshot for a single cluster, a disaster recovery (DR) replication cluster, or a performance replication cluster.

<Tabs>

<Tab heading="Single cluster" group="single">

### Save a single cluster snapshot

These examples show how to take a snapshot of a single cluster with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Use the Vault CLI to take a snapshot from the cluster members with a command like this example.

```shell-session
$ vault operator raft snapshot save backup.snap
```

This command writes a snapshot to the local file `backup.snap`.

Learn more in the [snapshot CLI documentation](/vault/docs/commands/operator/raft#snapshot).

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to take a snapshot from the cluster members with a command like this example.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request GET \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot > backup.snap
```

This command writes a snapshot to the local file `backup.snap`.

Learn more in the [snapshot API documentation](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster).

</Tab>

</Tabs>

</Tab>

<Tab heading="DR replication cluster" group="dr">

### Save a DR replication cluster snapshot

These examples show how to take a snapshot of a cluster participating in DR replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Take snapshots from the cluster members on the DR Primary cluster using a command like this example.

```shell-session
$ vault operator raft snapshot save primary.snap
```

This command writes a snapshot to the local file `primary.snap`.

Learn more in the [snapshot CLI documentation](/vault/docs/commands/operator/raft#snapshot).

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to take snapshots from the cluster members with a command like this example.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request GET \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot > primary.snap
```

This command writes a snapshot to the local file `primary.snap`.

Learn more in the [snapshot API documentation](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster).

</Tab>

</Tabs>

</Tab>

<Tab heading="Performance replication cluster" group="perf">

### Save a performance replication cluster snapshot

These examples show how to take a snapshot of a cluster participating in performance replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Take separate snapshots from the Vault Integrated Storage (Raft) cluster members
supporting both the Performance Primary cluster and Performance Secondary
cluster using commands like these examples.

First, take a snapshot on the primary cluster.

```shell-session
$ vault operator raft snapshot save primary.snap
```

This command writes a snapshot to the local file `primary.snap`.

Next, take a snapshot on the secondary cluster.

```shell-session
$ vault operator raft snapshot save secondary.snap
```

This command writes a snapshot to the local file `secondary.snap`.

Learn more in the [snapshot CLI documentation](/vault/docs/commands/operator/raft#snapshot).

</Tab>

<Tab heading="API" group="api">

Take separate snapshots from the Vault Integrated Storage (Raft) cluster members
supporting both the Performance Primary cluster and Performance Secondary
cluster using commands like these examples.

First, take a snapshot on the primary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request GET \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot > primary.snap
```

This command writes a snapshot to the local file `primary.snap`.

Next, take a snapshot on the secondary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request GET \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot > secondary.snap
```

This command writes a snapshot to the local file `secondary.snap`.

Learn more in the [snapshot API documentation](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster).

</Tab>

</Tabs>

</Tab>

</Tabs>

<Tip>

As a best practice, you should retain snapshot files in a secure place away from the Vault clusters and their infrastructure.

</Tip>

## Enable automatic cluster snapshots

@include 'alerts/enterprise-only.mdx'

Vault Enterprise features configurable automatic snapshots written to local or cloud storage on an interval. Follow these steps to enable automatic snapshots.

<Tabs>

<Tab heading="Single cluster" group="single">

### Enable a single cluster automatic snapshot

These examples show how to configure automatic snapshots for a single cluster with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automatic snapshots with the following example commands, based on the
instructions in the [automatic snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

**Example:**

The following command creates an automatic snapshot configuration named,
`testsnap` with a user defined location and interval.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/testsnap \
     storage_type=local \
     file_prefix=testsnappy \
     interval=120m \
     retain=7 \
     local_max_space=262144000 \
     path_prefix=/opt/vault/
```

This example specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retaining up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

<Tab heading="API" group="api">

Create a JSON payload to configure automatic snapshot settings.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "local",
    "file_prefix": "testsnappy",
    "interval": "120m",
    "retain": "7",
    "local_max_space": "262144000",
    "path_prefix": "/opt/vault/"
}
EOF
```

This example specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retaining up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API and JSON payload to configure automatic snapshots.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/testsnap
```

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

</Tabs>

</Tab>

<Tab heading="DR replication cluster" group="dr">

### Enable DR replication cluster automatic snapshots

These examples show how to configure automatic snapshots for a cluster participating in DR replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automatic snapshots with the following example commands, based on the
instructions in the [automatic snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

#### Enable automatic snapshots on primary cluster

The following command creates an automatic snapshot configuration named,
`paris-primary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/paris-primary \
    storage_type="aws-s3" \
    file_prefix="paris" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="primary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-west-3" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration also specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retaining up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

#### Enable automatic snapshots on secondary cluster

The following command creates an automatic snapshot configuration named,
`zurich-secondary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/zurich-secondary \
    storage_type="aws-s3" \
    file_prefix="zurich" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="secondary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-central-2" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration further defines local storage with both a filename and path prefix, a 12 hour snapshot interval, and retaining up to 14 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

<Tab heading="API" group="api">

#### Enable automatic snapshots on primary cluster

Create a JSON payload to configure automatic snapshot settings for the **primary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-west-3",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "paris",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "primary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retaining up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API to create an automatic snapshot configuration named `paris-primary` for the DR primary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/paris-primary
```

#### Enable automatic snapshots on secondary cluster

Create a JSON payload to configure automatic snapshot settings for the **secondary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-central-2",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "zurich",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "secondary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retaining up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API to create an automatic snapshot configuration named `zurich-secondary` for the DR secondary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    http://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/zurich-seconary
```

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots).

</Tab>

</Tabs>

</Tab>

<Tab heading="Performance replication cluster" group="perf">

### Enable performance replication cluster automatic snapshots

These examples show how to configure automatic snapshots for a cluster participating in performance replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automatic snapshots with the following example commands, based on the
instructions in the [automatic snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

<Tip>

You should configure each Vault cluster (forming the Primary and Secondary Vault Performance Replicas) to create separate automatic snapshots.

</Tip>

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

Learn more in the [CLI documentation](/vault/docs/commands/write).

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to...

```shell-session
$ 
```

Learn more in the [FIXME](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster) documentation.

</Tab>

</Tabs>

</Tab>

</Tabs>

<Tip title="Tutorial">

Refer to the [configure Vault cluster with Integrated Storage](/vault/tutorials/raft/raft-storage#automated-snapshots) tutorial to learn more.

</Tip>

## Restore a cluster snapshot

<Tabs>

<Tab heading="Single cluster" group="single">

### Restore a single cluster snapshot

<Tabs>

<Tab heading="CLI" group="cli">

1. Bring your Vault cluster back online following the circumstances that
required you to restore from backup. You must reinitialise your Vault
cluster with new storage, and authenticate with the new initial root token generated during this re-initialisation. Note that this situation is temporary- you still need the original cluster unseal keys to unseal Vault after restoring the snapshot.

1. Copy your Vault snapshot file to a Vault cluster member and run the
example command, replacing the example filename with that of your snapshot file. Note that you must use the `-force` flag in this command since the Auto-unseal or Shamir keys will not be consistent with the snapshot data as you are restoring a snapshot from a different cluster.

   ```shell-session
   $ vault operator raft snapshot restore -force backup.snap
   ```

   Learn more in the [CLI documentation](https://developer.hashicorp.com/vault/docs/commands/operator/raft#snapshot-restore).

1. Once you have restored the snapshot, you need to unseal your Vault
cluster again using a command like this example, run for each number of key shares required by the quroum defined in your original cluster configuration.

   ```shell-session
   $ vault operator unseal [unseal_key]
   ```

   Learn more in the [CLI documentation](/vault/docs/commands/operator/unseal).

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to...

```shell-session
$ 
```

Learn more in the [FIXME](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster) documentation.

</Tab>

</Tabs>

</Tab>

<Tab heading="DR replication cluster" group="dr">

### Restore a disaster recovery replication cluster snapshot

<Tabs>

<Tab heading="CLI" group="cli">

1. Bring your Vault cluster back online following the circumstances that
required you to restore from backup. You must reinitialise your Vault
cluster with new storage, and authenticate with the new initial root token generated during this re-initialisation. Note that this situation is temporary- you still need the original cluster unseal keys to unseal Vault after restoring the snapshot.

1. Copy your Vault snapshot files for the Primary and DR replica clusters onto restored members of the respective clusters and run the following example command, replacing the example filename with that of your snapshot file. Note that you must use the `-force` flag in this command since the Auto-unseal or Shamir keys will not be consistent with the snapshot data as you are restoring a snapshot from a different cluster.

   ```shell-session
   $ vault operator raft snapshot restore -force backup.snap
   ```

   Learn more in the [CLI documentation](/vault/docs/commands/operator/raft#snapshot-restore).

1. Once you have restored the snapshot, you need to unseal your Vault
cluster again using a command like this example, run for each number of key shares required by the quroum defined in your original cluster configuration.

   ```shell-session
   $ vault operator unseal [unseal_key]
   ```

   Learn more in the [CLI documentation](/vault/docs/commands/operator/unseal).

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to...

```shell-session
$ 
```

Learn more in the [FIXME](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster) documentation.

</Tab>

</Tabs>

</Tab>

<Tab heading="Performance replication cluster" group="perf">

### Restore a performance replication cluster snapshot

<Tabs>

<Tab heading="CLI" group="cli">

1. Bring your Vault cluster back online following the circumstances that
required you to restore from backup. You will need to reinitialise your Vault
cluster and log in with the new root token that was generated during its
reinitialisation. Note that these will be temporary- the original unseal keys
will be needed following restore.

1. Copy your Vault Raft Snapshots for the Primary and Secondary Performance
Replica clusters onto restored members of the respective clusters and run the
below following command, replacing the filename with that of your snapshot file.
Note, the `-force` option is required here since the Auto-unseal or Shamir keys
will not be consistent with the snapshot data as you will be restoring a
snapshot from a different cluster.

   ```shell-session
   $ vault operator raft snapshot restore -force backup.snap
   ```

1. Once you have restored the Raft snapshot you will need to unseal your Vault
cluster again using the following command

   ```shell-session
   $ vault operator unseal [unseal_key]
   ```

</Tab>

<Tab heading="API" group="api">

Use cURL with the Vault API to...

```shell-session
$ 
```

Learn more in the [FIXME](/vault/api-docs/system/storage/raft#take-a-snapshot-of-the-raft-cluster) documentation.

</Tab>

</Tabs>

</Tab>

</Tabs>

## Restore a secret from a snapshot

@include 'alerts/enterprise-only.mdx'

<Tabs>

<Tab heading="Single cluster" group="single">

### Restore a secret to a single cluster

<Tabs>

<Tab heading="CLI" group="cli">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ ...
```

Restore the secret by specifying its path.

```shell-session
$ ...
```

</Tab>

<Tab heading="API" group="api">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ curl ...
```

Restore the secret by specifying its path.

```shell-session
$ curl ...
```

</Tab>

</Tabs>

</Tab>

<Tab heading="DR replication cluster" group="dr">

### Restore a secret to a DR replication cluster

<Tabs>

<Tab heading="CLI" group="cli">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ ...
```

Restore the secret by specifying its path.

```shell-session
$ ...
```

</Tab>

<Tab heading="API" group="api">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ curl ...
```

Restore the secret by specifying its path.

```shell-session
$ curl ...
```

</Tab>

</Tabs>

</Tab>

<Tab heading="Performance replication cluster" group="perf">

### Restore a secret to a performanc replication cluster

<Tabs>

<Tab heading="CLI" group="cli">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ ...
```

Restore the secret by specifying its path.

```shell-session
$ ...
```

</Tab>

<Tab heading="API" group="api">

Load the snapshot that holds the secret you need to restore.

```shell-session
$ curl ...
```

Restore the secret by specifying its path.

```shell-session
$ curl ...
```

</Tab>

</Tabs>

</Tab>

</Tabs>
