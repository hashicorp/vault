---
layout: docs
page_title: Automate cluster snapshots
description: >-
  Automatically back up the data in your Vault cluster.
---

## Automate Vault cluster snapshots

@include 'alerts/enterprise-only.mdx'

You can configure Vault Enterprise to regularly save automated snapshots to
local or cloud storage.


## Before you start

- **You must a working knowledge of how Vault saves data**.
- **You must have a valid Vault cluster configuration using integratd storage**.
- **You must know, and be able to contact your unseal/recovery key holders**.
- **You must have permission to access encrypted data in backed storage**.
- **You should have a secure location, away from your Vault cluster
  infrastructure, to save the snapshot file**.



## Automate snapshots for a single cluster

Configure automated snapshots for a single cluster.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automated snapshots with the following example commands, based on the
instructions in the [automated snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

**Example:**

The following command creates an automated snapshot configuration named,
`testsnap` with a user defined location and interval.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/testsnap \
     storage_type=local \
     file_prefix=testsnappy \
     interval=120m \
     retain=7 \
     local_max_space=262144000 \
     path_prefix=/opt/vault/
```

This example specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retainins up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

<Tab heading="API" group="api">

Create a JSON payload to configure automated snapshot settings.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "local",
    "file_prefix": "testsnappy",
    "interval": "120m",
    "retain": "7",
    "local_max_space": "262144000",
    "path_prefix": "/opt/vault/"
}
EOF
```

This example specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retainins up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API and JSON payload to configure automated snapshots.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    https://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/testsnap
```

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

</Tabs>



## Automate snapshots for a DR replication cluster

These examples show how to configure automated snapshots for a cluster participating in DR Replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automated snapshots with the following example commands, based on the
instructions in the [automated snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

#### Enable automated snapshots on primary cluster

The following command creates an automated snapshot configuration named,
`paris-primary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/paris-primary \
    storage_type="aws-s3" \
    file_prefix="paris" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="primary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-west-3" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration also specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retainins up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

#### Enable automated snapshots on secondary cluster

The following command creates an automated snapshot configuration named,
`zurich-secondary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/zurich-secondary \
    storage_type="aws-s3" \
    file_prefix="zurich" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="secondary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-central-2" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration further defines local storage with both a filename and path prefix, a 12 hour snapshot interval, and retainins up to 14 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

<Tab heading="API" group="api">

#### Enable automated snapshots on primary cluster

Create a JSON payload to configure automated snapshot settings for the **primary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-west-3",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "paris",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "primary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retainins up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API to create an automated snapshot configuration named `paris-primary` for the DR primary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    https://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/paris-primary
```

#### Enable automated snapshots on secondary cluster

Create a JSON payload to configure automated snapshot settings for the **secondary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-central-2",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "zurich",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "secondary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retainins up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API to create an automated snapshot configuration named `zurich-secondary` for the DR secondary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    https://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/zurich-seconary
```

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots).

</Tab>

</Tabs>



## Automate snapshots for a performance replication cluster

These examples show how to configure automated snapshots for a cluster participating in performance replication with the Vault CLI or API.

<Tabs>

<Tab heading="CLI" group="cli">

Enable automated snapshots with the following example commands, based on the
instructions in the [automated snapshots with integrated storage documentation](/vault/docs/enterprise/automated-integrated-storage-snapshots)
with options specified in the [API
documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/[:name] [options]
```

#### Enable automated snapshots on primary cluster

The following command creates an automated snapshot configuration named,
`paris-primary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/paris-primary \
    storage_type="aws-s3" \
    file_prefix="paris" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="primary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-west-3" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration also specifies local storage with both a filename and path prefix, a 120 minute snapshot interval, and retainins up to 7 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 250 megabytes (262144000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

#### Enable automated snapshots on secondary cluster

The following command creates an automated snapshot configuration named,
`zurich-secondary` with a user defined location and interval.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ vault write sys/storage/raft/snapshot-auto/config/zurich-secondary \
    storage_type="aws-s3" \
    file_prefix="zurich" \
    interval="8h" \
    retain=30 \
    local_max_space=2621440000 \
    path_prefix="secondary" \
    aws_s3_bucket="vault-snapshots" \
    aws_s3_region="eu-central-2" \
    aws_access_key_id="ASI...COFFEE" \
    aws_secret_access_key="wJalr...COFFEEKEY" \
    aws_session_token="IQoJb3JpZ2luX2IQ...COFFEE" \
    aws_s3_server_side_encryption=true
```

The configuration further defines local storage with both a filename and path prefix, a 12 hour snapshot interval, and retainins up to 14 snapshots before deleting earlier snapshots. The configuration also requires that the snapshots with the given `file_prefix` value and in the specified `path_prefix` value consume no more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots#create-update-an-automated-snapshots-config).

</Tab>

<Tab heading="API" group="api">

#### Enable automated snapshots on primary cluster

Create a JSON payload to configure automated snapshot settings for the **primary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-west-3",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "paris",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "primary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retainins up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available. 

Use cURL with the Vault API to create an automated snapshot configuration named `paris-primary` for the DR primary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    https://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/paris-primary
```

#### Enable automated snapshots on secondary cluster

Create a JSON payload to configure automated snapshot settings for the **secondary** DR cluster.

This example specifies AWS S3 storage with appropriate AWS configuration options for the bucket name, the region, and required credentials. Snapshots are further protected with server side encryption.

```shell-session
$ cat > payload.json << EOF
{
    "storage_type": "aws-s3",
    "aws_s3_bucket": "vault-snapshots",
    "aws_s3_region": "eu-central-2",
    "aws_access_key_id": "ASIAIOSFODNN7ECOFFEE",
    "aws_secret_access_key ": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYECOFFEEKEY",
    "aws_session_token": "IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGECOFFEE",
    "aws_s3_server_side_encryption": true,
    "file_prefix": "zurich",
    "interval": "8h",
    "retain": "30",
    "local_max_space": "2621440000",
    "path_prefix": "secondary"
}
EOF
```

The configuration further defines both a filename and path prefix, an 8 hour snapshot interval, and retainins up to 30 snapshots before deleting earlier snapshots. Snapshots with the given `file_prefix` value and in the specified `path_prefix` value must not consume more than 2.6 gigabytes (2621440000 bytes) of storage. If snapshots reach this value, Vault cannot write a snapshot until enough space is available.

Use cURL with the Vault API to create an automated snapshot configuration named `zurich-secondary` for the DR secondary cluster.

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    https://127.0.0.1:8200/v1/sys/storage/raft/snapshot-auto/config/zurich-seconary
```

Learn more in the [API documentation](/vault/api-docs/system/storage/raftautosnapshots).

</Tab>

</Tabs>
